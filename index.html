<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escape Game ‚Äî Sistema Digest√≥rio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * { box-sizing: border-box; }
    
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
    
    .app-wrapper {
      height: 100%;
      width: 100%;
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-8px); }
      80% { transform: translateX(8px); }
    }
    
    .pulse-success {
      animation: pulseSuccess 0.6s ease-out;
    }
    
    @keyframes pulseSuccess {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .progress-fill {
      transition: width 0.5s ease-out;
    }
    
    .option-btn {
      transition: all 0.2s ease;
    }
    
    .option-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }
    
    .option-btn:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
      z-index: 1000;
    }
    
    @keyframes confettiFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    /* Bolhas Flutuantes */
    .floating-bubbles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .bubble {
      position: absolute;
      border: 2px solid rgba(34, 211, 238, 0.15);
      border-radius: 50%;
      background: radial-gradient(135deg at 30% 30%, rgba(34, 211, 238, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
      backdrop-filter: blur(10px);
      box-shadow: 
        inset -2px -2px 10px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(34, 211, 238, 0.1);
      animation: float-bubble 6s ease-in-out infinite;
    }

    @keyframes float-bubble {
      0%, 100% {
        transform: translateY(0px) translateX(0px);
        opacity: 0.3;
      }
      25% {
        transform: translateY(-30px) translateX(20px);
        opacity: 0.5;
      }
      50% {
        transform: translateY(-60px) translateX(-20px);
        opacity: 0.4;
      }
      75% {
        transform: translateY(-30px) translateX(10px);
        opacity: 0.5;
      }
    }

    /* Posicionamento relativo para conte√∫do */
    #startScreen,
    #gameScreen,
    #endScreen {
      position: relative;
      z-index: 10;
    }
    
    .key-appear {
      animation: keyAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    @keyframes keyAppear {
      0% { transform: scale(0) rotate(-90deg); opacity: 0; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    
    .key-float {
      animation: keyFloat 0.8s ease-out forwards;
    }
    
    @keyframes keyFloat {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-80px) scale(0.8); opacity: 0; }
    }
    
    .box-open {
      animation: boxOpen 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    @keyframes boxOpen {
      0% { transform: scaleY(1) rotateX(0deg); }
      50% { transform: scaleY(0.05) rotateX(-10deg); }
      100% { transform: scaleY(1) rotateX(0deg); }
    }
    
    .key-container {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      min-height: 80px;
      align-items: flex-end;
    }
    
    .key-item {
      position: relative;
      width: 60px;
      height: 60px;
      font-size: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .unite-animation {
      animation: unite 0.8s ease-in-out;
    }
    
    @keyframes unite {
      0% { transform: translate(var(--tx), var(--ty)); }
      100% { transform: translate(0, 0); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div class="app-wrapper" id="appWrapper" style="background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%); position: relative; overflow: hidden;"><!-- Bolhas Flutuantes de Fundo -->
   <div class="floating-bubbles">
    <div class="bubble" style="left: 5%; top: 10%; width: 120px; height: 120px; animation-delay: 0s;"></div>
    <div class="bubble" style="left: 85%; top: 20%; width: 80px; height: 80px; animation-delay: 2s;"></div>
    <div class="bubble" style="left: 15%; top: 70%; width: 100px; height: 100px; animation-delay: 4s;"></div>
    <div class="bubble" style="left: 80%; top: 60%; width: 90px; height: 90px; animation-delay: 6s;"></div>
    <div class="bubble" style="left: 50%; top: 15%; width: 70px; height: 70px; animation-delay: 3s;"></div>
    <div class="bubble" style="left: 25%; top: 50%; width: 110px; height: 110px; animation-delay: 5s;"></div>
    <div class="bubble" style="left: 70%; top: 80%; width: 85px; height: 85px; animation-delay: 1s;"></div>
    <div class="bubble" style="left: 10%; top: 30%; width: 95px; height: 95px; animation-delay: 7s;"></div>
   </div><!-- Tela Inicial -->
   <div id="startScreen" class="min-h-full flex flex-col items-center justify-center p-6 text-center fade-in">
    <div class="mb-8">
     <div class="text-7xl mb-6">
      üè•
     </div>
     <h1 id="mainTitle" class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-emerald-400 mb-3" style="font-family: 'Outfit', sans-serif;">ESCAPE GAME</h1>
     <p id="mainSubtitle" class="text-xl md:text-2xl text-slate-300 font-semibold" style="font-family: 'Outfit', sans-serif;">Sistema Digest√≥rio</p>
     <p class="text-slate-400 mt-4 max-w-md mx-auto">10 fases desafiadoras sobre anatomia do sistema digest√≥rio. Acerte para ganhar chaves e abrir caixas!</p>
    </div><button id="startBtn" class="option-btn px-10 py-4 bg-gradient-to-r from-cyan-500 to-emerald-500 text-white font-bold text-lg rounded-2xl shadow-lg shadow-cyan-500/30" style="font-family: 'Outfit', sans-serif;"> üöÄ Iniciar Jogo </button>
    <div class="mt-8 flex gap-6 text-slate-400">
     <div class="text-center">
      <div class="text-2xl font-bold text-cyan-400">
       10
      </div>
      <div class="text-sm">
       Chaves
      </div>
     </div>
     <div class="text-center">
      <div class="text-2xl font-bold text-emerald-400">
       üèÜ
      </div>
      <div class="text-sm">
       Escape!
      </div>
     </div>
    </div>
   </div><!-- Tela do Jogo -->
   <div id="gameScreen" class="min-h-full p-4 md:p-6 hidden">
    <div class="max-w-3xl mx-auto"><!-- Header -->
     <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3"><span class="text-3xl">üî¨</span>
       <div>
        <h2 id="gameTitle" class="text-lg font-bold text-cyan-400" style="font-family: 'Outfit', sans-serif;">Escape Game</h2>
        <p class="text-slate-400 text-sm">Sistema Digest√≥rio</p>
       </div>
      </div>
      <div id="phaseIndicator" class="bg-slate-800/80 px-4 py-2 rounded-xl border border-slate-700"><span class="text-cyan-400 font-bold" style="font-family: 'Outfit', sans-serif;">Fase <span id="currentPhase">1</span>/10</span>
      </div>
     </div><!-- Barra de Progresso -->
     <div class="mb-6">
      <div class="h-3 bg-slate-800 rounded-full overflow-hidden border border-slate-700">
       <div id="progressBar" class="progress-fill h-full bg-gradient-to-r from-cyan-500 to-emerald-500 rounded-full" style="width: 0%"></div>
      </div>
     </div><!-- Container de Chaves Coletadas -->
     <div class="mb-6 p-4 bg-slate-800/40 rounded-2xl border border-slate-700/50">
      <p class="text-slate-400 text-sm mb-3 text-center">üîë Chaves coletadas:</p>
      <div class="key-container" id="keyContainer"><!-- Chaves aparecer√£o aqui -->
      </div>
     </div><!-- Card da Pergunta -->
     <div id="questionCard" class="bg-slate-800/60 backdrop-blur-sm rounded-3xl border border-slate-700/50 p-6 md:p-8 shadow-2xl fade-in"><!-- T√≠tulo da Fase -->
      <div class="flex items-center gap-3 mb-4"><span id="phaseIcon" class="text-2xl">ü´Å</span>
       <h3 id="phaseTitle" class="text-xl font-bold text-white" style="font-family: 'Outfit', sans-serif;">Perit√¥nio</h3>
      </div><!-- Pergunta -->
      <p id="questionText" class="text-lg text-slate-200 mb-6 leading-relaxed">Qual √≥rg√£o abaixo √© considerado secundariamente retroperitoneal?</p><!-- Imagem da Fase -->
      <div id="imageContainer" class="mb-8 rounded-2xl overflow-hidden bg-slate-700/30 border border-slate-600/50 flex items-center justify-center min-h-64"><img id="phaseImage" src="" alt="Ilustra√ß√£o da fase" class="w-full h-full object-cover" loading="lazy" onerror="console.error('Imagem falhou:', this.src); this.style.background='#334155'; this.alt='Imagem indispon√≠vel';">
      </div><!-- Op√ß√µes -->
      <div id="optionsContainer" class="grid gap-3"><!-- Op√ß√µes ser√£o inseridas via JS -->
      </div><!-- Feedback com Box e Chave -->
      <div id="feedback" class="hidden mt-6 text-center">
       <div id="feedbackContainer" class="mb-4 min-h-12">
        <p id="feedbackText" class="font-semibold text-lg"></p>
       </div><!-- Box com Chave -->
       <div id="boxContainer" class="hidden relative flex justify-center mb-6">
        <div class="text-8xl box-open">
         üì¶
        </div>
        <div id="floatingKey" class="absolute text-6xl key-appear" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
         üîë
        </div>
       </div>
      </div><!-- Bot√£o Pr√≥xima --> <button id="nextBtn" class="hidden w-full mt-6 py-4 bg-gradient-to-r from-cyan-500 to-emerald-500 text-white font-bold text-lg rounded-2xl shadow-lg option-btn" style="font-family: 'Outfit', sans-serif;"> Pr√≥xima Fase ‚Üí </button>
     </div>
    </div>
   </div><!-- Tela Final -->
   <div id="endScreen" class="min-h-full flex flex-col items-center justify-center p-6 text-center hidden">
    <div class="fade-in">
     <div id="finalEmoji" class="text-8xl mb-6">
      üèÜ
     </div>
     <h2 id="finalTitle" class="text-3xl md:text-4xl font-black text-white mb-4" style="font-family: 'Outfit', sans-serif;">PARAB√âNS!</h2>
     <p id="finalMessage" class="text-xl text-cyan-400 font-bold mb-8" style="font-family: 'Outfit', sans-serif;">VOC√ä ESCAPOU!</p>
     <div class="bg-slate-800/60 backdrop-blur-sm rounded-3xl border border-slate-700/50 p-8 mb-8 max-w-sm mx-auto">
      <h3 class="text-lg font-semibold text-slate-400 mb-6">Chaves Coletadas</h3>
      <div class="key-container" id="finalKeyContainer"><!-- 10 chaves finais -->
      </div>
      <div class="mt-6 text-4xl font-black text-emerald-400" style="font-family: 'Outfit', sans-serif;">
       ‚ú® 10/10 ‚ú®
      </div>
     </div><button id="restartBtn" class="option-btn px-10 py-4 bg-gradient-to-r from-cyan-500 to-emerald-500 text-white font-bold text-lg rounded-2xl shadow-lg shadow-cyan-500/30" style="font-family: 'Outfit', sans-serif;"> üîÑ Jogar Novamente </button>
    </div>
   </div>
  </div>
  <script>
    // Dados das 10 fases
    const phases = [
      {
        id: 1,
        icon: "ü´Å",
        title: "Perit√¥nio",
        question: "Qual √≥rg√£o abaixo √© considerado secundariamente retroperitoneal?",
        image: "assets/image/q1_question_20206210_080350_0000.png",
        options: [
          { letter: "A", text: "Est√¥mago" },
          { letter: "B", text: "Ba√ßo" },
          { letter: "C", text: "Jejuno" },
          { letter: "D", text: "Duodeno (2¬™-4¬™ por√ß√µes)" },
          { letter: "E", text: "Ap√™ndice vermiforme" }
        ],
        correct: "D"
      },
      {
        id: 2,
        icon: "ü´Ä",
        title: "Segmenta√ß√£o Hep√°tica",
        question: "Os segmentos anat√¥mico-funcionais do f√≠gado s√£o definidos principalmente com base:",
        image: "assets/image/q2_question_20206210_080535_0000.png",
        options: [
          { letter: "A", text: "Na drenagem das veias hep√°ticas" },
          { letter: "B", text: "Nos ligamentos do f√≠gado" },
          { letter: "C", text: "Na divis√£o em lobos anat√¥micos" },
          { letter: "D", text: "Na inerva√ß√£o do √≥rg√£o" },
          { letter: "E", text: "Na ramifica√ß√£o portal (veia porta, art√©ria hep√°tica e ductos biliares)" }
        ],
        correct: "E"
      },
      {
        id: 3,
        icon: "üß¨",
        title: "Intestino Delgado",
        question: "Qual caracter√≠stica anat√¥mica diferencia o jejuno do √≠leo?",
        image: "assets/image/q3_question_20206210_080921_0000.png",
        options: [
          { letter: "A", text: "Maior quantidade de tecido linfoide no jejuno" },
          { letter: "B", text: "Paredes mais espessas e pregas circulares mais desenvolvidas no jejuno" },
          { letter: "C", text: "Presen√ßa de vilosidades apenas no √≠leo" },
          { letter: "D", text: "O jejuno recebe secre√ß√µes pancre√°ticas e o √≠leo n√£o" },
          { letter: "E", text: "O √≠leo est√° fixado pelo mesent√©rio e o jejuno n√£o" }
        ],
        correct: "B"
      },
      {
        id: 4,
        icon: "üî¨",
        title: "Retroperit√¥nio",
        question: "√ìrg√£o primariamente retroperitoneal:",
        image: "assets/image/q4_question_20206210_081233_0000.png",
        options: [
          { letter: "A", text: "Est√¥mago" },
          { letter: "B", text: "Duodeno (2¬™-4¬™ por√ß√µes)" },
          { letter: "C", text: "C√≥lon ascendente" },
          { letter: "D", text: "Rins" },
          { letter: "E", text: "P√¢ncreas (corpo e cauda)" }
        ],
        correct: "D"
      },
      {
        id: 5,
        icon: "üìç",
        title: "Pregas Circulares",
        question: "As pregas circulares s√£o mais desenvolvidas no:",
        image: "assets/image/q5_question_20206210_081443_0000.png",
        options: [
          { letter: "A", text: "Es√¥fago" },
          { letter: "B", text: "Duodeno" },
          { letter: "C", text: "Jejuno" },
          { letter: "D", text: "√çleo" },
          { letter: "E", text: "C√≥lon" }
        ],
        correct: "C"
      },
      {
        id: 6,
        icon: "üåÄ",
        title: "T√™nias C√≥licas",
        question: "As t√™nias c√≥licas est√£o presentes no:",
        image: "assets/image/q6_question_20206210_081817_0000.png",
        options: [
          { letter: "A", text: "Jejuno" },
          { letter: "B", text: "√çleo" },
          { letter: "C", text: "Est√¥mago" },
          { letter: "D", text: "C√≥lon" },
          { letter: "E", text: "Reto" }
        ],
        correct: "D"
      },
      {
        id: 7,
        icon: "ü™±",
        title: "Ap√™ndice Vermiforme",
        question: "O ap√™ndice vermiforme origina-se do:",
        image: "assets/image/q7_question_20206210_082024_0000.png",
        options: [
          { letter: "A", text: "√çleo terminal" },
          { letter: "B", text: "C√≥lon ascendente" },
          { letter: "C", text: "Ceco" },
          { letter: "D", text: "V√°lvula ileocecal" },
          { letter: "E", text: "C√≥lon transverso" }
        ],
        correct: "C"
      },
      {
        id: 8,
        icon: "üíß",
        title: "Drenagem no Duodeno",
        question: "O que o duodeno recebe?",
        image: "assets/image/q8_question_20206210_082335_0000.png",
        options: [
          { letter: "A", text: "Apenas bile" },
          { letter: "B", text: "Apenas suco pancre√°tico" },
          { letter: "C", text: "Apenas quimo g√°strico" },
          { letter: "D", text: "Col√©doco + ducto pancre√°tico principal" },
          { letter: "E", text: "Secre√ß√µes do √≠leo" }
        ],
        correct: "D"
      },
      {
        id: 9,
        icon: "üìé",
        title: "Fixa√ß√£o pelo Mesent√©rio",
        question: "O mesent√©rio fixa principalmente o:",
        image: "assets/image/q9_question_20206210_082954_0000.png",
        options: [
          { letter: "A", text: "Est√¥mago" },
          { letter: "B", text: "Duodeno" },
          { letter: "C", text: "Jejuno e √≠leo" },
          { letter: "D", text: "C√≥lon ascendente" },
          { letter: "E", text: "Reto" }
        ],
        correct: "C"
      },
      {
        id: 10,
        icon: "‚Ü™Ô∏è",
        title: "Flexura C√≥lica Esquerda",
        question: "A flexura c√≥lica esquerda relaciona-se superiormente com o:",
        image: "assets/image/q10_question_20206210_083917_0000.png",
        options: [
          { letter: "A", text: "F√≠gado" },
          { letter: "B", text: "Ba√ßo" },
          { letter: "C", text: "Rim esquerdo" },
          { letter: "D", text: "Est√¥mago" },
          { letter: "E", text: "P√¢ncreas" }
        ],
        correct: "B"
      }
    ];

    // Estado do jogo
    let currentPhaseIndex = 0;
    let collectedKeys = [];
    let answered = false;

    // Elementos DOM
    const startScreen = document.getElementById('startScreen');
    const gameScreen = document.getElementById('gameScreen');
    const endScreen = document.getElementById('endScreen');
    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const restartBtn = document.getElementById('restartBtn');
    const currentPhaseEl = document.getElementById('currentPhase');
    const progressBar = document.getElementById('progressBar');
    const phaseIcon = document.getElementById('phaseIcon');
    const phaseTitle = document.getElementById('phaseTitle');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const feedback = document.getElementById('feedback');
    const feedbackText = document.getElementById('feedbackText');
    const questionCard = document.getElementById('questionCard');
    const keyContainer = document.getElementById('keyContainer');
    const boxContainer = document.getElementById('boxContainer');
    const floatingKey = document.getElementById('floatingKey');

    // Config para edi√ß√£o
    const defaultConfig = {
      game_title: "ESCAPE GAME",
      subtitle: "Sistema Digest√≥rio",
      victory_text: "PARAB√âNS! VOC√ä ESCAPOU!"
    };

    let config = { ...defaultConfig };

    // Fun√ß√µes do jogo
    function startGame() {
      currentPhaseIndex = 0;
      collectedKeys = [];
      
      startScreen.classList.add('hidden');
      endScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');
      
      updateKeyDisplay();
      loadPhase();
    }

    function loadPhase() {
      answered = false;
      const phase = phases[currentPhaseIndex];
      
      currentPhaseEl.textContent = currentPhaseIndex + 1;
      progressBar.style.width = `${(currentPhaseIndex / 10) * 100}%`;
      
      phaseIcon.textContent = phase.icon;
      phaseTitle.textContent = phase.title;
      questionText.textContent = phase.question;
      
      // Carregar imagem
      const phaseImage = document.getElementById('phaseImage');
      phaseImage.src = phase.image;
      
      // Criar op√ß√µes
      optionsContainer.innerHTML = '';
      phase.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn w-full text-left p-4 bg-slate-700/50 hover:bg-slate-700 border border-slate-600 rounded-xl transition-all flex items-center gap-4';
        btn.innerHTML = `
          <span class="flex-shrink-0 w-10 h-10 bg-slate-600 rounded-lg flex items-center justify-center font-bold text-cyan-400" style="font-family: 'Outfit', sans-serif;">${opt.letter}</span>
          <span class="text-slate-200">${opt.text}</span>
        `;
        btn.onclick = () => selectOption(opt.letter, btn);
        optionsContainer.appendChild(btn);
      });
      
      // Esconder feedback e bot√£o pr√≥xima
      feedback.classList.add('hidden');
      boxContainer.classList.add('hidden');
      nextBtn.classList.add('hidden');
      
      // Anima√ß√£o
      questionCard.classList.remove('fade-in');
      void questionCard.offsetWidth;
      questionCard.classList.add('fade-in');
    }

    function selectOption(letter, btn) {
      if (answered) return;
      answered = true;
      
      const phase = phases[currentPhaseIndex];
      const isCorrect = letter === phase.correct;
      
      // Desabilitar todas as op√ß√µes
      const allBtns = optionsContainer.querySelectorAll('button');
      allBtns.forEach(b => {
        b.disabled = true;
        b.classList.add('opacity-60');
      });
      
      feedback.classList.remove('hidden');
      
      if (isCorrect) {
        btn.classList.remove('bg-slate-700/50', 'border-slate-600', 'opacity-60');
        btn.classList.add('bg-emerald-500/30', 'border-emerald-500');
        
        feedbackText.textContent = '‚úÖ Correto! Voc√™ ganhou uma chave!';
        feedbackText.classList.remove('text-rose-400');
        feedbackText.classList.add('text-emerald-400');
        
        questionCard.classList.add('pulse-success');
        setTimeout(() => questionCard.classList.remove('pulse-success'), 600);
        
        // Mostrar caixa abrindo e chave flutuando
        setTimeout(() => {
          boxContainer.classList.remove('hidden');
          collectedKeys.push(currentPhaseIndex + 1);
          
          setTimeout(() => {
            floatingKey.classList.add('key-float');
            
            setTimeout(() => {
              updateKeyDisplay();
              floatingKey.classList.remove('key-float');
              nextBtn.classList.remove('hidden');
              
              if (currentPhaseIndex === phases.length - 1) {
                nextBtn.textContent = 'üèÜ Abrir Todas!';
              } else {
                nextBtn.textContent = 'Pr√≥xima Fase ‚Üí';
              }
            }, 800);
          }, 600);
        }, 300);
      } else {
        btn.classList.remove('bg-slate-700/50', 'border-slate-600', 'opacity-60');
        btn.classList.add('bg-rose-500/30', 'border-rose-500');
        
        // Mostrar resposta correta
        allBtns.forEach(b => {
          const letterSpan = b.querySelector('span');
          if (letterSpan && letterSpan.textContent === phase.correct) {
            b.classList.remove('opacity-60');
            b.classList.add('bg-emerald-500/30', 'border-emerald-500');
          }
        });
        
        feedbackText.textContent = `‚ùå Incorreto! A resposta certa √©: ${phase.correct}`;
        feedbackText.classList.remove('text-emerald-400');
        feedbackText.classList.add('text-rose-400');
        
        questionCard.classList.add('shake');
        setTimeout(() => questionCard.classList.remove('shake'), 500);
        
        nextBtn.classList.remove('hidden');
        nextBtn.textContent = 'Pr√≥xima Fase ‚Üí';
      }
    }

    function updateKeyDisplay() {
      keyContainer.innerHTML = '';
      for (let i = 1; i <= 10; i++) {
        const keyItem = document.createElement('div');
        keyItem.className = 'key-item';
        
        if (collectedKeys.includes(i)) {
          keyItem.innerHTML = 'üîë';
          keyItem.style.opacity = '1';
        } else {
          keyItem.innerHTML = 'üîí';
          keyItem.style.opacity = '0.3';
        }
        
        keyContainer.appendChild(keyItem);
      }
    }

    function nextPhase() {
      currentPhaseIndex++;
      
      if (currentPhaseIndex >= phases.length) {
        showEndScreen();
      } else {
        loadPhase();
      }
    }

    function showEndScreen() {
      gameScreen.classList.add('hidden');
      endScreen.classList.remove('hidden');
      
      document.getElementById('finalTitle').textContent = config.victory_text.split('\n')[0] || 'PARAB√âNS!';
      
      // Mostrar todas as 10 chaves na tela final
      const finalKeyContainer = document.getElementById('finalKeyContainer');
      finalKeyContainer.innerHTML = '';
      for (let i = 0; i < 10; i++) {
        const keyItem = document.createElement('div');
        keyItem.className = 'key-item key-appear';
        keyItem.textContent = 'üîë';
        keyItem.style.animationDelay = `${i * 0.1}s`;
        finalKeyContainer.appendChild(keyItem);
      }
      
      // Confetes e anima√ß√£o de chaves se unindo
      setTimeout(() => {
        createMassConfetti();
      }, 800);
    }

    function createMassConfetti() {
      const colors = ['#22d3ee', '#4ade80', '#fbbf24', '#f472b6', '#a78bfa', '#ec4899'];
      
      // Muitos confetes caindo
      for (let i = 0; i < 150; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * 100 + 'vw';
          confetti.style.top = '-10px';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          confetti.style.animation = `confettiFall ${2 + Math.random() * 3}s linear forwards`;
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 5000);
        }, i * 30);
      }
    }

    function restartGame() {
      endScreen.classList.add('hidden');
      startScreen.classList.remove('hidden');
    }

    // Fun√ß√£o de renderiza√ß√£o para o SDK
    async function onConfigChange(cfg) {
      config = { ...defaultConfig, ...cfg };
      
      document.getElementById('mainTitle').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('mainSubtitle').textContent = config.subtitle || defaultConfig.subtitle;
      document.getElementById('gameTitle').textContent = config.game_title || defaultConfig.game_title;
      document.getElementById('finalTitle').textContent = config.victory_text || defaultConfig.victory_text;
    }

    // Event listeners
    startBtn.addEventListener('click', startGame);
    nextBtn.addEventListener('click', nextPhase);
    restartBtn.addEventListener('click', restartGame);

    // Inicializa√ß√£o do SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (cfg) => ({
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ["game_title", cfg.game_title || defaultConfig.game_title],
          ["subtitle", cfg.subtitle || defaultConfig.subtitle],
          ["victory_text", cfg.victory_text || defaultConfig.victory_text]
        ])
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cbb7a247386034b',t:'MTc3MDcyNTE1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
